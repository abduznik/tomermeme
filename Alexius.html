
<html>
<head>
  <meta charset="utf-8" />
</head>
<body>
  
  <script>
    var odyc = (function (exports) {
    'use strict';

    var D=class{rect;width;height;position=[0,0];screenWidth;screenHeight;constructor(e){this.screenWidth=e.screenWidth,this.screenHeight=e.screenHeight,e.cameraWidth&&e.cameraHeight&&(this.width=e.cameraWidth,this.height=e.cameraHeight,this.rect={left:(e.screenWidth-this.width)*.5,right:(e.screenWidth+this.width)*.5-1,top:(e.screenHeight-this.height)*.5,bottom:(e.screenHeight+this.height)*.5-1});}update(e,x){let[t,i]=e;if(!this.rect||!this.screenWidth||!this.screenHeight){this.position[0]=Math.floor(t/this.screenWidth)*this.screenWidth,this.position[1]=Math.floor(i/this.screenHeight)*this.screenHeight,this.clamp(x);return}let[s,n]=this.position,o=t-s,a=i-n;o<this.rect.left&&(this.position[0]-=this.rect.left-o),o>this.rect.right&&(this.position[0]+=o-this.rect.right),a<this.rect.top&&(this.position[1]-=this.rect.top-a),a>this.rect.bottom&&(this.position[1]+=a-this.rect.bottom),this.clamp(x);}isOnScreen(e){let[x,t]=e,i=x-this.position[0],s=t-this.position[1];return i>=0&&s>=0&&i<this.screenWidth&&s<this.screenHeight}reset(){this.position=[0,0];}clamp(e){let[x,t]=e;this.position[0]=Math.max(0,Math.min(this.position[0],x-this.screenWidth)),this.position[1]=Math.max(0,Math.min(this.position[1],t-this.screenHeight));}},Q=r=>new D(r);var J={player:{sprite:0},templates:{},map:`
		........
		........
		........
		........
		........
		........
		........
		........
	`,colors:["#212529","#f8f9fa","#ced4da","#228be6","#fa5252","#fcc419","#ff922b","#40c057","#f06595","#a52f01"],messageBackground:0,messageColor:1,dialogBackground:0,dialogColor:1,dialogBorder:1,screenWidth:8,screenHeight:8,cellWidth:8,cellHeight:8,background:1,volume:.5,controls:{LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",ACTION:["Enter","Space"]}};var v=r=>r.trim().replace(/[ \t]/gm,"").split(/\n+/gm),e0=r=>{let e=r.length;return [Math.max(...r.map(t=>t.length)),e]};var L=r=>{try{return new URL(r),!0}catch{return !1}};var t0=(...r)=>r.reduce((e,x)=>[e[0]+x[0],e[1]+x[1]],[0,0]),g=(...r)=>!r.some((e,x)=>{let t=r[x-1];return t?t[0]!==e[0]||t[1]!==e[1]:!1});var b=r=>{let e=0,x=r,t=new Map;return {subscribe:i=>{let s=e;return e++,t.set(s,i),i(x),()=>{t.delete(s);}},set:i=>{x=i,t.forEach(s=>{s(x);});},silentSet:i=>{x=i;},get:()=>x,update:i=>{x=i(x),t.forEach(s=>{s(x);});},silentUpdate:i=>{x=i(x);}}};var x0=(r,e)=>{let x;return (...t)=>{let i;return x&&clearTimeout(x),x=setTimeout(()=>{i=r(...t);},e),i}};var U0=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[24,60,60,24,24,0,24,0],[54,54,0,0,0,0,0,0],[54,54,127,54,127,54,54,0],[12,62,3,30,48,31,12,0],[0,99,51,24,12,102,99,0],[28,54,28,110,59,51,110,0],[6,6,3,0,0,0,0,0],[24,12,6,6,6,12,24,0],[6,12,24,24,24,12,6,0],[0,102,60,255,60,102,0,0],[0,12,12,63,12,12,0,0],[0,0,0,0,0,12,12,6],[0,0,0,63,0,0,0,0],[0,0,0,0,0,12,12,0],[96,48,24,12,6,3,1,0],[62,99,115,123,111,103,62,0],[12,14,12,12,12,12,63,0],[30,51,48,28,6,51,63,0],[30,51,48,28,48,51,30,0],[56,60,54,51,127,48,120,0],[63,3,31,48,48,51,30,0],[28,6,3,31,51,51,30,0],[63,51,48,24,12,12,12,0],[30,51,51,30,51,51,30,0],[30,51,51,62,48,24,14,0],[0,12,12,0,0,12,12,0],[0,12,12,0,0,12,12,6],[24,12,6,3,6,12,24,0],[0,0,63,0,0,63,0,0],[6,12,24,48,24,12,6,0],[30,51,48,24,12,0,12,0],[62,99,123,123,123,3,30,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[60,102,3,3,3,102,60,0],[31,54,102,102,102,54,31,0],[127,70,22,30,22,70,127,0],[127,70,22,30,22,6,15,0],[60,102,3,3,115,102,124,0],[51,51,51,63,51,51,51,0],[30,12,12,12,12,12,30,0],[120,48,48,48,51,51,30,0],[103,102,54,30,54,102,103,0],[15,6,6,6,70,102,127,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[28,54,99,99,99,54,28,0],[63,102,102,62,6,6,15,0],[30,51,51,51,59,30,56,0],[63,102,102,62,54,102,103,0],[30,51,7,14,56,51,30,0],[63,45,12,12,12,12,30,0],[51,51,51,51,51,51,63,0],[51,51,51,51,51,30,12,0],[99,99,99,107,127,119,99,0],[99,99,54,28,28,54,99,0],[51,51,51,30,12,12,30,0],[127,99,49,24,76,102,127,0],[30,6,6,6,6,6,30,0],[3,6,12,24,48,96,64,0],[30,24,24,24,24,24,30,0],[8,28,54,99,0,0,0,0],[0,0,0,0,0,0,0,255],[12,12,24,0,0,0,0,0],[0,0,30,48,62,51,110,0],[7,6,6,62,102,102,59,0],[0,0,30,51,3,51,30,0],[56,48,48,62,51,51,110,0],[0,0,30,51,63,3,30,0],[28,54,6,15,6,6,15,0],[0,0,110,51,51,62,48,31],[7,6,54,110,102,102,103,0],[12,0,14,12,12,12,30,0],[48,0,48,48,48,51,51,30],[7,6,102,54,30,54,103,0],[14,12,12,12,12,12,30,0],[0,0,51,127,127,107,99,0],[0,0,31,51,51,51,51,0],[0,0,30,51,51,51,30,0],[0,0,59,102,102,62,6,15],[0,0,110,51,51,62,48,120],[0,0,59,110,102,6,15,0],[0,0,62,3,30,48,31,0],[8,12,62,12,12,44,24,0],[0,0,51,51,51,51,110,0],[0,0,51,51,51,30,12,0],[0,0,99,107,127,127,54,0],[0,0,99,54,28,54,99,0],[0,0,51,51,51,62,48,31],[0,0,63,25,12,38,63,0],[56,12,12,7,12,12,56,0],[24,24,24,0,24,24,24,0],[7,12,12,56,12,12,7,0],[110,59,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],k0=[[0,0,0,0,0,0,0,0],[24,24,0,24,24,24,24,0],[24,24,126,3,3,126,24,24],[28,54,38,15,6,103,63,0],[0,0,99,62,54,62,99,0],[51,51,30,63,12,63,12,12],[24,24,24,0,24,24,24,0],[124,198,28,54,54,28,51,30],[51,0,0,0,0,0,0,0],[60,66,153,133,133,153,66,60],[60,54,54,124,0,0,0,0],[0,204,102,51,102,204,0,0],[0,0,0,63,48,48,0,0],[0,0,0,0,0,0,0,0],[60,66,157,165,157,165,66,60],[126,0,0,0,0,0,0,0],[28,54,54,28,0,0,0,0],[24,24,126,24,24,0,126,0],[28,48,24,12,60,0,0,0],[28,48,24,48,28,0,0,0],[24,12,0,0,0,0,0,0],[0,0,102,102,102,62,6,3],[254,219,219,222,216,216,216,0],[0,0,0,24,24,0,0,0],[0,0,0,0,0,24,48,30],[8,12,8,28,0,0,0,0],[28,54,54,28,0,0,0,0],[0,51,102,204,102,51,0,0],[195,99,51,189,236,246,243,3],[195,99,51,123,204,102,51,240],[3,196,99,180,219,172,230,128],[12,0,12,6,3,51,30,0],[7,0,28,54,99,127,99,0],[112,0,28,54,99,127,99,0],[28,54,0,62,99,127,99,0],[110,59,0,62,99,127,99,0],[99,28,54,99,127,99,99,0],[12,12,0,30,51,63,51,0],[124,54,51,127,51,51,115,0],[30,51,3,51,30,24,48,30],[7,0,63,6,30,6,63,0],[56,0,63,6,30,6,63,0],[12,18,63,6,30,6,63,0],[54,0,63,6,30,6,63,0],[7,0,30,12,12,12,30,0],[56,0,30,12,12,12,30,0],[12,18,0,30,12,12,30,0],[51,0,30,12,12,12,30,0],[63,102,111,111,102,102,63,0],[63,0,51,55,63,59,51,0],[14,0,24,60,102,60,24,0],[112,0,24,60,102,60,24,0],[60,102,24,60,102,60,24,0],[110,59,0,62,99,99,62,0],[195,24,60,102,102,60,24,0],[0,54,28,8,28,54,0,0],[92,54,115,123,111,54,29,0],[14,0,102,102,102,102,60,0],[112,0,102,102,102,102,60,0],[60,102,0,102,102,102,60,0],[51,0,51,51,51,51,30,0],[112,0,102,102,60,24,24,0],[15,6,62,102,102,62,6,15],[0,30,51,31,51,31,3,3],[7,0,30,48,62,51,126,0],[56,0,30,48,62,51,126,0],[126,195,60,96,124,102,252,0],[110,59,30,48,62,51,126,0],[51,0,30,48,62,51,126,0],[12,12,30,48,62,51,126,0],[0,0,254,48,254,51,254,0],[0,0,30,3,3,30,48,28],[7,0,30,51,63,3,30,0],[56,0,30,51,63,3,30,0],[126,195,60,102,126,6,60,0],[51,0,30,51,63,3,30,0],[7,0,14,12,12,12,30,0],[28,0,14,12,12,12,30,0],[62,99,28,24,24,24,60,0],[51,0,14,12,12,12,30,0],[27,14,27,48,62,51,30,0],[0,31,0,31,51,51,51,0],[0,7,0,30,51,51,30,0],[0,56,0,30,51,51,30,0],[30,51,0,30,51,51,30,0],[110,59,0,30,51,51,30,0],[0,51,0,30,51,51,30,0],[24,24,0,126,0,24,24,0],[0,96,60,118,126,110,60,6],[0,7,0,51,51,51,126,0],[0,56,0,51,51,51,126,0],[30,51,0,51,51,51,126,0],[0,51,0,51,51,51,126,0],[0,56,0,51,51,62,48,31],[0,0,6,62,102,62,6,0],[0,51,0,51,51,62,48,31]],W0=[[45,0,12,12,12,44,24,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[63,51,3,3,3,3,3,0],[8,28,28,54,54,99,127,0],[127,70,22,30,22,70,127,0],[127,99,49,24,76,102,127,0],[51,51,51,63,51,51,51,0],[28,54,99,127,99,54,28,0],[30,12,12,12,12,12,30,0],[103,102,54,30,54,102,103,0],[8,28,28,54,54,99,99,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[127,99,0,62,0,99,127,0],[28,54,99,99,99,54,28,0],[127,54,54,54,54,54,54,0],[63,102,102,62,6,6,15,0],[0,1,2,4,79,144,160,64],[127,99,6,12,6,99,127,0],[63,45,12,12,12,12,30,0],[51,51,51,30,12,12,30,0],[24,126,219,219,219,126,24,0],[99,99,54,28,54,99,99,0],[219,219,219,126,24,24,60,0],[62,99,99,99,54,54,119,0],[51,0,30,12,12,12,30,0],[51,0,51,51,30,12,30,0],[112,0,110,59,19,59,110,0],[56,0,30,3,14,3,30,0],[56,0,31,51,51,51,51,48],[56,0,12,12,12,44,24,0],[45,0,51,51,51,51,30,0],[0,0,110,59,19,59,110,0],[0,30,51,31,51,31,3,3],[0,0,51,51,30,12,12,0],[56,12,24,62,51,51,30,0],[0,0,30,3,14,3,30,0],[0,63,6,3,3,30,48,28],[0,0,31,51,51,51,51,48],[0,0,30,51,63,51,30,0],[0,0,12,12,12,44,24,0],[0,0,51,27,15,27,51,0],[0,3,6,12,28,54,99,0],[0,0,102,102,102,62,6,3],[0,0,51,51,51,30,12,0],[30,3,14,3,3,30,48,28],[0,0,30,51,51,51,30,0],[0,0,127,54,54,54,54,0],[0,0,60,102,102,54,6,6],[0,0,62,3,3,30,48,28],[0,0,126,27,27,27,14,0],[0,0,126,24,24,88,48,0],[0,0,51,51,51,51,30,0],[0,0,118,219,219,126,24,0],[0,99,54,28,28,54,99,0],[0,0,219,219,219,126,24,0],[0,0,54,99,107,127,54,0]],G0=[[0,0,0,0,0,0,0,0],[4,63,4,60,86,77,38,0],[4,63,4,60,86,77,38,0],[0,0,0,17,33,37,2,0],[0,1,17,33,33,37,2,0],[0,28,0,28,34,32,24,0],[60,0,60,66,64,32,24,0],[28,0,62,16,56,36,98,0],[28,0,62,16,56,36,98,0],[36,79,4,60,70,69,34,0],[36,79,4,60,70,69,34,0],[4,36,79,84,82,18,9,0],[68,36,15,84,82,82,9,0],[8,31,8,63,28,2,60,0],[68,47,4,31,14,1,30,0],[16,8,4,2,4,8,16,0],[40,68,18,33,2,4,8,0],[0,34,121,33,33,34,16,0],[64,34,17,61,17,18,8,0],[0,0,60,0,2,2,60,0],[32,64,22,32,1,1,14,0],[16,126,16,60,2,2,28,0],[36,79,20,46,1,1,14,0],[0,2,2,2,66,34,28,0],[32,66,18,34,2,34,28,0],[16,126,24,20,24,16,12,0],[68,47,6,5,6,4,3,0],[32,114,47,34,26,2,28,0],[128,80,58,23,26,2,28,0],[30,8,4,127,8,4,56,0],[79,36,2,127,8,4,56,0],[2,15,2,114,2,9,113,0],[66,47,2,114,2,9,113,0],[8,126,8,60,64,64,56,0],[68,47,4,30,32,32,28,0],[0,0,0,28,34,32,28,0],[0,28,34,65,64,32,28,0],[64,32,30,33,32,32,28,0],[0,62,8,4,4,4,56,0],[0,62,72,36,4,4,56,0],[4,4,8,60,2,2,60,0],[68,36,8,60,2,2,60,0],[50,2,39,34,114,41,17,0],[0,2,122,2,10,114,2,0],[8,9,62,75,101,85,34,0],[4,7,52,76,102,84,36,0],[0,0,60,74,73,69,34,0],[0,34,122,34,114,42,18,0],[128,81,29,17,57,21,9,0],[64,177,93,17,57,21,9,0],[0,0,19,50,81,17,14,0],[64,32,3,50,81,17,14,0],[64,160,67,50,81,17,14,0],[28,0,8,42,73,16,12,0],[76,32,8,42,73,16,12,0],[76,160,72,10,41,72,12,0],[0,0,4,10,17,32,64,0],[32,64,20,42,17,32,64,0],[32,80,36,10,17,32,64,0],[125,17,125,17,57,85,9,0],[157,81,29,17,57,85,9,0],[93,177,93,17,57,85,9,0],[126,8,62,8,28,42,4,0],[0,7,36,36,126,37,18,0],[4,15,100,6,5,38,60,0],[0,9,61,74,75,69,42,0],[2,15,2,15,98,66,60,0],[0,0,18,31,34,18,4,0],[0,18,63,66,66,52,4,0],[0,0,17,61,83,57,17,0],[0,17,61,83,81,57,17,0],[0,8,56,8,28,42,4,0],[8,8,56,8,28,42,4,0],[30,0,2,58,70,66,48,0],[0,32,34,34,42,36,16,0],[31,8,60,66,73,84,56,0],[4,7,4,12,22,85,36,0],[63,16,8,60,66,65,48,0],[0,0,8,14,56,76,42,0],[4,7,4,60,70,69,36,0],[14,8,60,74,105,85,50,0],[6,60,66,57,4,54,73,0],[4,15,4,110,17,8,112,0],[8,8,4,12,86,82,33,0],[64,46,0,60,66,64,56,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[64,128,32,64,0,0,0,0],[64,160,64,0,0,0,0,0],[0,0,8,8,16,48,12,0],[32,64,20,36,8,24,6,0],[0,0,0,0,0,0,0,0]],H0=[[255,255,255,255,0,0,0,0],[0,0,0,0,0,0,0,255],[0,0,0,0,0,0,255,255],[0,0,0,0,0,255,255,255],[0,0,0,0,255,255,255,255],[0,0,0,255,255,255,255,255],[0,0,255,255,255,255,255,255],[0,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255],[127,127,127,127,127,127,127,127],[63,63,63,63,63,63,63,63],[31,31,31,31,31,31,31,31],[15,15,15,15,15,15,15,15],[7,7,7,7,7,7,7,7],[3,3,3,3,3,3,3,3],[1,1,1,1,1,1,1,1],[240,240,240,240,240,240,240,240],[85,0,170,0,85,0,170,0],[85,170,85,170,85,170,85,170],[255,170,255,85,255,170,255,85],[255,0,0,0,0,0,0,0],[128,128,128,128,128,128,128,128],[0,0,0,0,15,15,15,15],[0,0,0,0,240,240,240,240],[15,15,15,15,0,0,0,0],[15,15,15,15,255,255,255,255],[15,15,15,15,240,240,240,240],[255,255,255,255,15,15,15,15],[255,255,255,255,240,240,240,240],[240,240,240,240,0,0,0,0],[240,240,240,240,15,15,15,15],[240,240,240,240,255,255,255,255]],r0=[{start:0,characters:U0},{start:160,characters:k0},{start:912,characters:W0},{start:12352,characters:G0},{start:9600,characters:H0}];var i0={"~":"waveY",_:"waveX","%":"shake","=":"shakeX","^":"shakeY","\xB0":"blink"},A=8,T=class r{#t;#x;#i;#e;#r;constructor(e,x,t){this.#i=e,this.#e=x,this.#r=t,this.#t=[{pattern:"\\\\.",type:"char",process:i=>i.charAt(1)},{pattern:this.#o(e),type:"char"},{pattern:"<\\d>",type:"color",process:i=>i.charAt(1)},{pattern:Object.keys(i0).map(this.#o).join("|"),type:"effect",process:i=>i0[i]},{pattern:"[^\\n\\r\\t]",type:"char"}],this.#x=new RegExp(this.#t.map(i=>`(${i.pattern})`).join("|"),"g");}parseText(e,x){let t=this.#s(e),i=this.#a(t);return this.#n(i,x)}draw(e,x,t,i,s){for(let n=0;n<x.length;n++){let o=x[n];if(o===void 0)continue;let a=t+n*A,c=i,f=o.color?this.#r[o.color]:null;switch(f?e.fillStyle=f:e.fillStyle=this.#e,o.effect){case"waveY":c+=Math.floor(Math.sin(s*.01+n)*3);break;case"waveX":a+=Math.floor(Math.sin(s*.01+n)*2);break;case"shake":a+=Math.floor((Math.random()-.5)*2),c+=Math.floor((Math.random()-.5)*2);break;case"shakeX":a+=Math.floor((Math.random()-.5)*2);break;case"shakeY":c+=Math.floor((Math.random()-.5)*2);break;case"blink":Math.sin(s*.015)>0&&(e.fillStyle="transparent");break}r.#c(e,o.value,a,c);}}#s(e){let x=e.matchAll(this.#x),t=[];for(let i of x){i.shift();let s=i.findIndex(c=>c!==void 0),{type:n,process:o}=this.#t[s],a=o?o(i[s]):i[s];t.push({value:a,type:n});}return t}#a(e){let x=[],t=[],i=[];for(let s=0;s<e.length;s++){let n=e[s];if(!n)continue;let{type:o,value:a}=n;if(o==="char"){let c=t[t.length-1],f=i[i.length-1];x.push({value:a,color:c,effect:f});continue}if(n.type==="color"){let c=t.lastIndexOf(parseInt(a));c!==-1?t.splice(c,1):t.push(parseInt(a));continue}if(n.type==="effect"){let c=i.lastIndexOf(a);c!==-1?i.splice(c,1):i.push(a);}}return x}#n(e,x){let t=[];e:for(;e.length>0;){let i=e.findIndex((s,n)=>s.value===this.#i&&n<x);if(i!==-1){t.push(e.splice(0,i)),e.splice(0,1);continue}else if(e.length<=x){t.push(e),e=[];continue}for(let s=x;s>=0;s--)if(e[s]?.value===" "){t.push(e.splice(0,s)),e.splice(0,1);continue e}t.push(e.splice(0,x));}return e.length>0&&t.push(e),t}#o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static#c(e,x,t,i){let s=x.charCodeAt(0),n=this.#l(s);if(n)for(let o=0;o<A;o++){let a=n[o];if(a!==void 0)for(let c=0;c<A;c++)a&1<<c&&e.fillRect(t+c,i+o,1,1);}}static text(e,x,t,i){for(let s=0;s<x.length;s++){let n=x.charAt(s);r.#c(e,n,t+s*A,i);}}static#l(e){let x=r0.find(t=>e>=t.start&&e<t.start+t.characters.length);return x?x.characters[e-x.start]:null}};var F=384,N0=30,E=2,s0=28,n0=10,o0=8,a0=12,V0=8,R=2,O=class{#t;#x;#i;#e;#r;#s=[];#a=0;#n;#o=0;#c;isOpen=!1;#l;#u;#d;#m;#h;#f;#p;#g;constructor(e){this.#l=e.colors,this.#u=this.#v(e.dialogBackground),this.#d=this.#v(e.dialogColor),this.#m=this.#v(e.dialogBorder),this.#t=document.createElement("canvas"),this.#t.style.setProperty("position","absolute"),this.#t.style.setProperty("box-sizing","border-box"),this.#t.style.setProperty("display","none"),this.#t.style.setProperty("image-rendering","pixelated"),this.#x=this.#t.getContext("2d"),this.#t.width=F,this.#t.height=F,this.#t.classList.add("odyc-dialog-canvas"),this.#b(),document.body.append(this.#t),window.addEventListener("resize",this.#b),this.#f=s0*8+o0*2,this.#h=E*V0+a0*2+n0*(E-1),this.#p=(this.#t.width-this.#f)*.5,this.#g=this.#t.height-this.#h-Math.floor(F/15),this.#c=new T("|",this.#d,e.colors);}async open(e){if(!(e.length<=0))return this.isOpen=!0,this.#t.style.setProperty("display","block"),this.#e=this.#c.parseText(e,s0),this.#r=this.#e.shift(),this.#s=new Array(E).fill(null).map(x=>[]),this.#n=requestAnimationFrame(this.#y),new Promise(x=>{this.#i=()=>x();})}next(){this.#r&&this.#r.length>0||this.#a<E-1||(this.#r=this.#e?.shift(),this.#a=0,this.#s=this.#s.map(()=>[]),this.#r===void 0&&this.#T());}#y=e=>{if(this.#n=requestAnimationFrame(this.#y),e-this.#o<N0)return;this.#o=e,this.#r?.length===0&&this.#a<E-1&&(this.#a++,this.#r=this.#e?.shift());let x=this.#r?.shift();x&&this.#s[this.#a]?.push(x),this.#P(e);};#T(){this.isOpen=!1,this.#t.style.setProperty("display","none"),this.#a=0,this.#i?.(),this.#n&&cancelAnimationFrame(this.#n);}#b=()=>{let e=Math.min(window.innerWidth,window.innerHeight),x=(window.innerWidth-e)*.5,t=(window.innerHeight-e)*.5;this.#t.style.setProperty("width",`${e}px`),this.#t.style.setProperty("height",`${e}px`),this.#t.style.setProperty("left",`${x}px`),this.#t.style.setProperty("top",`${t}px`);};#P=e=>{this.#S();let x=this.#p+o0;for(let t=0;t<this.#s.length;t++){let i=this.#s[t];if(!i)continue;let s=this.#g+a0+8*t+t*n0;this.#c.draw(this.#x,i,x,s,e);}};#S(){this.#x.clearRect(0,0,this.#t.width,this.#t.height),this.#x.fillStyle=this.#m,this.#x.fillRect(this.#p-R,this.#g-R,this.#f+R*2,this.#h+R*2),this.#x.fillStyle=this.#u,this.#x.fillRect(this.#p,this.#g,this.#f,this.#h);}#v(e){return typeof e=="string"?e:this.#l[e]??"black"}},c0=r=>new O(r);var l0=({gameState:r,messageBox:e,camera:x})=>({play:async(...t)=>{t.length&&e.open(t),x.reset(),r.player.restoreSavedState(),r.actors.reset();}});var U=`attribute vec2 a_position;
varying vec2 v_texCoords;
void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texCoords = a_position * vec2(0.5, -0.5) + 0.5;
}
`;var k=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;

void main() {
    gl_FragColor = texture2D(u_texture, v_texCoords);
}
`;var h0=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;
uniform float u_sideCount;
uniform float u_scale;
uniform float u_rotation;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

void main() {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI + u_rotation * TWO_PI;
    float r = TWO_PI / float(u_sideCount);

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    float threshold = 1.0 - step(u_scale, d);
    gl_FragColor = texture2D(u_texture, v_texCoords) * threshold;
}
`;var f0=`precision mediump float;
varying vec2 v_texCoords;

uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_warp;
uniform float u_lineWidth;
uniform float u_lineIntensity;
uniform float u_lineCount;

void main() {
    vec2 fragCoord = v_texCoords * u_size;
    vec2 uv = v_texCoords;

    vec2 dc = abs(0.5 - uv);
    dc *= dc;

    uv.x -= 0.5;
    uv.x *= 1.0 + dc.y * (0.3 * u_warp);
    uv.x += 0.5;

    uv.y -= 0.5;
    uv.y *= 1.0 + dc.x * (0.4 * u_warp);
    uv.y += 0.5;

    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
        gl_FragColor = vec4(0.0);
    } else {
        float dist = abs(fract(uv.y * u_lineCount) - 0.5);
        float scanLine = min(step(u_lineWidth * .5, dist) + (1. - u_lineIntensity), 1.);

        vec3 color = texture2D(u_texture, uv).rgb;
        gl_FragColor = vec4(color * scanLine, 1.0);
    }
}
`;var u0=`precision mediump float;

varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_scale;
uniform float u_intensity;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

float mosaic(float scale) {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI;
    float r = TWO_PI / 4.;

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    return 1.0 - step(scale, d);
}

vec3 blur() {
    vec2 radius = CELL_SIZE / u_size;
    vec3 blur = vec3(0);
    float count = 0.;

    for (int j = 0; j < 16; j++) {
        float d = float(j) * TWO_PI / 16.;
        vec2 offset = vec2(cos(d), sin(d)) / (u_size / CELL_SIZE);
        blur += texture2D(u_texture, v_texCoords + offset).rgb;
        count++;
    }

    return blur / count;
}

void main() {
    vec3 color = texture2D(u_texture, v_texCoords).rgb;

    vec3 with_blur = mix(color, blur(), u_intensity);
    gl_FragColor = vec4(max(color, with_blur), 1.) * mosaic(u_scale);
}
`;var W={fractal:{fragment:h0,settings:{sideCount:12,scale:.9,rotation:0}},crt:{fragment:f0,settings:{warp:.7,lineIntensity:.2,lineWidth:.6,lineCount:85}},neon:{fragment:u0,settings:{scale:.75,intensity:.8}}},m0=r=>{if("name"in r){let e=Object.assign({},W[r.name].settings,r.settings);return {vertex:W[r.name].vertex??U,fragment:W[r.name].fragment??k,settings:e}}return {vertex:r.vertex??U,fragment:r.fragment??k,settings:r.settings}};var G=class{canvas;#t;#x={};#i;#e;#r;#s;#a;#n=new Map;#o;constructor(e,x){if(this.#t=m0(x),this.#t.settings)for(let n in this.#t.settings){let o=this.#t.settings?.[n];this.#x[n]=Array.isArray(o)?[...o]:o;}this.#i=e,this.canvas=document.createElement("canvas"),this.canvas.width=this.#i.width,this.canvas.height=this.#i.height,this.canvas.style.setProperty("position","absolute"),this.canvas.style.setProperty("image-rendering","pixelated"),this.canvas.classList.add("odyc-filter-canvas"),window.addEventListener("resize",this.#c);let t=this.canvas.getContext("webgl",{preserveDrawingBuffer:!0});if(!t)throw new Error("WebGL not supported");this.#e=t;let i=this.#l(this.#e.VERTEX_SHADER,this.#t.vertex),s=this.#l(this.#e.FRAGMENT_SHADER,this.#t.fragment);this.#r=this.#u(i,s),this.#e.useProgram(this.#r),this.#o=this.#e.getAttribLocation(this.#r,"a_position"),this.#a=this.#d(),this.#s=this.#m(),this.#c(),this.#i.after(this.canvas),this.#i.style.setProperty("display","none");}render(){this.#p("size",[this.canvas.width,this.canvas.height]),this.#x&&Object.entries(this.#x).forEach(([e,x])=>{this.#p(e,x);}),this.#e.viewport(0,0,this.canvas.width,this.canvas.height),this.#e.clearColor(0,0,0,1),this.#e.clear(this.#e.COLOR_BUFFER_BIT),this.#h(),this.#e.bindBuffer(this.#e.ARRAY_BUFFER,this.#a),this.#e.enableVertexAttribArray(this.#o),this.#e.vertexAttribPointer(this.#o,2,this.#e.FLOAT,!1,0,0),this.#e.drawArrays(this.#e.TRIANGLES,0,6);}setUniforms(e){for(let[x,t]of Object.entries(e))this.#x[x]=Array.isArray(t)?[...t]:t;}#c=()=>{let e=this.canvas.width<this.canvas.height?"vertical":"horizontal",x=Math.min(window.innerWidth,window.innerHeight),t=e==="horizontal"?x:x/this.canvas.height*this.canvas.width,i=e==="vertical"?x:x/this.canvas.width*this.canvas.height,s=(window.innerWidth-t)*.5,n=(window.innerHeight-i)*.5;this.canvas.style.setProperty("width",`${t}px`),this.canvas.style.setProperty("height",`${i}px`),this.canvas.style.setProperty("left",`${s}px`),this.canvas.style.setProperty("top",`${n}px`),this.render();};#l(e,x){let t=this.#e.createShader(e);if(this.#e.shaderSource(t,x),this.#e.compileShader(t),!this.#e.getShaderParameter(t,this.#e.COMPILE_STATUS)){let i=this.#e.getShaderInfoLog(t);throw this.#e.deleteShader(t),new Error(`Shader compilation failed:
${i}`)}return t}#u(e,x){let t=this.#e.createProgram();if(this.#e.attachShader(t,e),this.#e.attachShader(t,x),this.#e.linkProgram(t),!this.#e.getProgramParameter(t,this.#e.LINK_STATUS)){let i=this.#e.getProgramInfoLog(t);throw this.#e.deleteProgram(t),new Error(`Program link failed:
${i}`)}if(this.#e.validateProgram(t),!this.#e.getProgramParameter(t,this.#e.VALIDATE_STATUS))throw new Error("validating program"+this.#e.getProgramInfoLog(t));return t}#d(){let e=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),x=this.#e.createBuffer();if(this.#e.bindBuffer(this.#e.ARRAY_BUFFER,x),this.#e.bufferData(this.#e.ARRAY_BUFFER,e,this.#e.STATIC_DRAW),this.#e.bindBuffer(this.#e.ARRAY_BUFFER,null),!x)throw new Error("failed to create quad");return x}#m(){let e=this.#e.createTexture();if(this.#e.bindTexture(this.#e.TEXTURE_2D,e),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_WRAP_S,this.#e.CLAMP_TO_EDGE),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_WRAP_T,this.#e.CLAMP_TO_EDGE),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_MIN_FILTER,this.#e.NEAREST),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_MAG_FILTER,this.#e.NEAREST),this.#e.texImage2D(this.#e.TEXTURE_2D,0,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,this.#i),this.#e.bindTexture(this.#e.TEXTURE_2D,null),!e)throw new Error("failed to create texture");return e}#h(){this.#e.bindTexture(this.#e.TEXTURE_2D,this.#s),this.#e.texImage2D(this.#e.TEXTURE_2D,0,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,this.#i);}#f(e){let x=`u_${e}`;if(this.#n.has(x))return this.#n.get(x);let t=this.#e.getUniformLocation(this.#r,x);return t&&this.#n.set(x,t),t}#p(e,x){let t=this.#f(e);if(t){if(typeof x=="number"&&(x=[x]),x.length<1||x.length>4)throw new Error("setUniform supports 1\u20134 float values");switch(x.length){case 1:this.#e.uniform1f(t,x[0]);break;case 2:this.#e.uniform2f(t,x[0],x[1]);break;case 3:this.#e.uniform3f(t,x[0],x[1],x[2]);break;case 4:this.#e.uniform4f(t,x[0],x[1],x[2],x[3]);break}}}},p0=(r,e)=>e?new G(r,e):null;var d0=(r,e,x,t,i,s)=>({player:r.player.playerProxy,getCell:r.actors.getCell,addToCell:r.actors.addToCell,setCell:r.actors.setCell,getAll:r.actors.getAll,setAll:r.actors.setAll,openDialog:o=>e.open(o),prompt:(...o)=>x.open(...o),openMenu:o=>x.openMenu(o),openMessage:(...o)=>s.open(o),playSound:(...o)=>t.play(...o),end:(...o)=>i.play(...o),loadMap:(o,a)=>{a&&(r.player.playerProxy.position=[...a]),r.mapStore.store.set(o),r.player.saveCurrentState();},updateFilter:o=>{r.uniformsStore.update(a=>{for(let[c,f]of Object.entries(o))a[c]=Array.isArray(f)?[...f]:f;return a});},get width(){return r.mapStore.getDimensions()[0]},get height(){return r.mapStore.getDimensions()[1]}});var H=class{gameState;soundPlayer;dialog;ender;constructor(e){this.gameState=e.gameState,this.soundPlayer=e.soundPlayer,this.dialog=e.dialog,this.ender=e.ender;}async update(e){let x=this.gameState.player.playerProxy.position,t=t0(x,$0[e]);if(!this.isCellOnScreen(t))return;let i=this.gameState.actors.getCell(...x),s=this.gameState.actors.getCell(...t),n=s.sound;if(n){let a=Array.isArray(n)?n:[n];this.soundPlayer.play(...a);}let o=s.end;if(s.solid){let a=s.dialog;a&&await this.dialog.open(a),await this.gameState.actors.getEvent(...t,"onCollide")?.(s);}else if(this.gameState.actors.getEvent(...x,"onLeave")?.(i),g(x,this.gameState.player.playerProxy.position)&&(this.gameState.player.playerProxy.position=t),s){let a=s?.dialog;a?this.dialog.open(a).then(()=>{this.gameState.actors.getEvent(...t,"onEnter")?.(s);}):this.gameState.actors.getEvent(...t,"onEnter")?.(s);}o&&(typeof o=="string"?await this.ender.play(o):typeof o=="boolean"&&o?this.ender.play():await this.ender.play(...o));}isCellOnScreen([e,x]){return e>=0&&x>=0&&e<this.gameState.mapStore.getDimensions()[0]&&x<this.gameState.mapStore.getDimensions()[1]}getActorOnCell(e,x){return e.find(({position:t})=>t[0]===x[0]&&t[1]===x[1])}},$0={LEFT:[-1,0],RIGHT:[1,0],UP:[0,-1],DOWN:[0,1],ACTION:[0,0]},g0=r=>new H(r);var N=(r,e)=>{let x=[];e.subscribe(n=>x=n);let t=()=>x.find(n=>g(n.position,r)),i=(n,o)=>{e.update(a=>{for(let c=0;c<a.length;c++){let f=a[c];!f||a[c]===void 0||!g(f.position,r)||(a[c][n]=o);}return a});};return {get sprite(){return t()?.sprite??null},set sprite(n){i("sprite",n);},get solid(){return t()?.solid??!1},set solid(n){i("solid",n);},get sound(){return t()?.sound??null},set sound(n){i("sound",n);},get position(){return t()?.position??[-1,-1]},get dialog(){return t()?.dialog??null},set dialog(n){i("dialog",n);},get visible(){return t()?.visible??!1},set visible(n){i("visible",n);},get end(){return t()?.end??null},set end(n){i("end",n);},get symbol(){return t()?.symbol??null},remove:()=>{e.update(n=>n.filter(o=>!g(o.position,r)));}}};var b0=(r,e)=>{let x=r.templates,t=[],i=b(t);return i.subscribe(h=>{t=h;}),e.store.subscribe(h=>{i.set(y0(v(h),x));}),{getCell:(h,l)=>N([h,l],i),setCell:(h,l,u)=>{i.update(m=>{for(let p=0;p<m.length;p++){let y=m[p];if(!y||!y.position||!g(y.position,[h,l]))continue;let O0=Object.assign({},y,u);m[p]=O0;}return m});},getAll:h=>t.filter(l=>l.symbol===h).map(l=>N(l.position,i)),setAll:(h,l)=>{i.update(u=>{for(let m=0;m<u.length;m++){let p=u[m];if(p?.symbol!==h)continue;let y=Object.assign({},p,l);u[m]=y;}return u});},addToCell:(h,l,u)=>{let m=v0(x,u);m&&i.update(p=>[...p.filter(y=>!g([h,l],y.position)),T0(h,l,u,m)]);},getEvent:(h,l,u)=>i.get().find(m=>m.position[0]===h&&m.position[1]===l)?.[u],reset:()=>i.set(y0(v(e.store.get()),x)),_store:i}},y0=(r,e)=>{let x=[];for(let t=0;t<r.length;t++){let i=r[t];if(i)for(let s=0;s<i.length;s++){let n=i[s];if(!n)continue;let o=v0(e,n);o&&x.push(T0(s,t,n,o));}}return x},T0=(r,e,x,t)=>({symbol:x,sprite:t.sprite??null,position:[r,e],dialog:t.dialog??null,onScreen:!1,end:t.end??null,sound:t.sound??null,solid:t.solid!==!1,visible:t.visible!==!1,onCollide:t.onCollide,onEnter:t.onEnter,onLeave:t.onLeave,onScreenEnter:t.onScreenEnter,onScreenLeave:t.onScreenLeave}),v0=(r,e)=>{let x=r[e];if(x)return typeof x=="function"?x():x};var P0=r=>{let e={};for(let t in r){let i=r[t];i!==void 0&&(e[t]=Array.isArray(i)?[...i]:i);}return b(e)};var S0=r=>{let e=b(r),x=[0,0];return e.subscribe(t=>{x=e0(v(t));}),{store:e,getDimensions(){return x}}};var E0=r=>{let e=r.sprite??null,x=r.position??[0,0],t=r.sprite??null,i=r.position??[0,0],s=b({sprite:t,position:i});return s.subscribe(c=>{t=c.sprite??null,i=c.position;}),{playerProxy:{get sprite(){return t},set sprite(c){s.set({sprite:c,position:i});},get position(){return i},set position(c){s.set({sprite:t,position:c});}},playerStore:s,restoreSavedState:()=>{s.set({sprite:e,position:x});},saveCurrentState:()=>{e=t,x=[...i];}}};var w0=r=>{let e=S0(r.map),x=P0(r.filter?.settings??{}),t=E0(r.player),i=b0(r,e);return {player:t,actors:i,mapStore:e,uniformsStore:x}};var V=class{controls;lastKeysEvents=new Map;onInput;lastPointerEvent=0;oldTouchX;oldTouchY;pointerId;isSliding=!1;constructor(e,x){this.controls=Object.entries(e.controls),this.onInput=x;let t=document.createElement("div");t.style.setProperty("position","absolute"),t.style.setProperty("left","0"),t.style.setProperty("height","0"),t.style.setProperty("width","100vw"),t.style.setProperty("height","100vh"),t.style.setProperty("overflow","hidden"),t.style.setProperty("touch-action","none"),document.body.appendChild(t),document.body.style.setProperty("margin","0"),document.addEventListener("keydown",this.handleKeydown),t.addEventListener("pointerdown",this.handleTouch),t.addEventListener("pointerup",this.handleTouchUp),t.addEventListener("pointerleave",this.handleTouchLeave),t.addEventListener("pointercancel",this.handleTouchLeave),t.addEventListener("pointermove",this.handleTouchMove);}handleTouch=e=>{e.pointerType!=="mouse"&&(this.pointerId=e.pointerId,this.oldTouchX=e.clientX,this.oldTouchY=e.clientY);};handleTouchUp=e=>{this.pointerId===e.pointerId&&(this.pointerId=void 0,this.isSliding||this.onInput("ACTION"),this.isSliding=!1);};handleTouchLeave=e=>{this.pointerId===e.pointerId&&(this.pointerId=void 0,this.isSliding=!1);};handleTouchMove=e=>{if(this.pointerId!==e.pointerId)return;let x=e.clientX,t=e.clientY;if(x===void 0||t===void 0||this.oldTouchX===void 0||this.oldTouchY===void 0)return;let i=x-this.oldTouchX,s=t-this.oldTouchY,n=e.timeStamp;if(!(Math.abs(i)<30&&Math.abs(s)<30)&&!(n-this.lastPointerEvent<200))if(this.lastPointerEvent=n,this.oldTouchX=x,this.oldTouchY=t,this.isSliding=!0,Math.abs(s)>Math.abs(i)){let o=Math.sign(s);this.onInput(o<0?"UP":"DOWN");}else {let o=Math.sign(i);this.onInput(o<0?"LEFT":"RIGHT");}};handleKeydown=e=>{let x=this.controls.find(([n,o])=>o===e.code||o.includes(e.code));if(!x)return;let[t]=x,i=e.timeStamp,s=this.lastKeysEvents.get(e.code);e.repeat&&s&&i-s<200||(this.lastKeysEvents.set(e.code,i),this.onInput(t));}},C0=(r,e)=>new V(r,e);var j0=30,B=class{#t;#x;isOpen=!1;#i;#e=[];#r=[];#s;#a;#n=0;#o;#c=0;#l;#u;#d;#m;#h=192;#f=1;#p=2;constructor(e){this.#u=e.colors,this.#d=this.#b(e.messageBackground),this.#m=this.#b(e.messageColor),this.#s=Math.floor((this.#h-2*this.#f)/8),this.#a=Math.floor(this.#h/(8+this.#p)),this.#t=document.createElement("canvas"),this.#t.style.setProperty("position","absolute"),this.#t.style.setProperty("box-sizing","border-box"),this.#t.style.setProperty("display","none"),this.#t.style.setProperty("image-rendering","pixelated"),this.#x=this.#t.getContext("2d"),this.#t.width=this.#h,this.#t.height=this.#h,this.#t.classList.add("odyc-message-canvas"),this.#l=new T(`
`,this.#m,this.#u),this.#g(),window.addEventListener("resize",this.#g),document.body.append(this.#t);}#g=()=>{let e=Math.min(window.innerWidth,window.innerHeight),x=(window.innerWidth-e)*.5,t=(window.innerHeight-e)*.5;this.#t.style.setProperty("width",`${e}px`),this.#t.style.setProperty("height",`${e}px`),this.#t.style.setProperty("left",`${x}px`),this.#t.style.setProperty("top",`${t}px`);};open(e){let x=typeof e=="string"?[e]:[...e];if(x.length===0||x[0]?.length===0)return;this.isOpen=!0,this.#e=x;let t=this.#e[this.#n];if(t)return this.#r=this.#l.parseText(t,this.#s),this.#t.style.removeProperty("display"),this.#o=requestAnimationFrame(this.#y),new Promise(i=>this.#i=()=>i())}next(){this.#n++;let e=this.#e[this.#n];e?(this.#r=this.#l.parseText(e,this.#s),this.#o=requestAnimationFrame(this.#y)):this.close();}#y=e=>{this.#o=requestAnimationFrame(this.#y),!(e-this.#c<j0)&&this.#T(e);};#T(e){this.#x.clearRect(0,0,this.#t.width,this.#t.height),this.#x.fillStyle=this.#d,this.#x.fillRect(0,0,this.#t.width,this.#t.height),this.#x.fillStyle=this.#m;let x=Math.min(this.#r.length,this.#a),t=x*8+(x-1)*this.#p,i=(this.#t.height-t)*.5;for(let s=0;s<x;s++){let n=this.#r[s];if(!n)continue;let o=n.length*8,a=(this.#t.width-o)*.5,c=i+s*8+s*this.#p;this.#l.draw(this.#x,n,a,c,e);}}close=()=>{this.#n=0,this.#r=[],this.isOpen=!1,this.#o&&cancelAnimationFrame(this.#o),this.#t.style.setProperty("display","none"),this.#i?.();};#b(e){return typeof e=="string"?e:this.#u[e]??"black"}},A0=r=>new B(r);var X=384,d=2,R0=28,q=10,w=8,z=12,_=8,I=2,Y=class{#t;#x;#i;isOpen=!1;#e=[];#r=0;#s;#a;#n;#o;constructor(e){this.#s=e.colors,this.#a=this.#f(e.dialogBackground),this.#n=this.#f(e.dialogColor),this.#o=this.#f(e.dialogBorder),this.#t=document.createElement("canvas"),this.#t.style.setProperty("position","absolute"),this.#t.style.setProperty("box-sizing","border-box"),this.#t.style.setProperty("display","none"),this.#t.style.setProperty("image-rendering","pixelated"),this.#x=this.#t.getContext("2d"),this.#t.width=X,this.#t.height=X,this.#t.classList.add("odyc-prompt-canvas"),this.#m(),document.body.append(this.#t),window.addEventListener("resize",this.#m);}get#c(){let e=R0*8+w*2,x=(this.#t.width-e)*.5,t=Math.floor(X/15),i=Math.max(Math.ceil(this.#e.length/d),2),s=i*_+z*2+q*(i-1);return {left:x,top:t,width:e,height:s}}async openMenu(e){let x=Object.keys(e),t=x[await this.open(...x)];if(!t||!(t in e))return;let i=e[t];if(i)return typeof i=="function"?i():await this.openMenu(i)}async open(...e){return e.length?(this.#r=0,this.isOpen=!0,this.#t.style.setProperty("display","block"),this.#e=e,this.#u(),new Promise(x=>{this.#i=t=>x(t);})):-1}input(e){let x=Math.ceil(this.#e.length/d),t=Math.floor(this.#r/d),i=this.#r-t*d;switch(e){case"LEFT":i=Math.max(0,i-1);break;case"UP":t=Math.max(0,t-1);break;case"RIGHT":i=Math.min(i+1,d-1);break;case"DOWN":t=Math.min(t+1,x-1);break;case"ACTION":this.#l();return}this.#r=Math.min(t*d+i,this.#e.length-1),this.#u();}#l(){this.isOpen=!1,this.#t.style.setProperty("display","none"),this.#i?.(this.#r);}#u(){this.#h();let{left:e,top:x,width:t}=this.#c;this.#x.fillStyle=this.#n;let i=Math.ceil(R0/d-d);for(let s=0;s<this.#e.length;s++){let n=this.#e[s]?.slice(0,i);if(!n)continue;let o=Math.floor(s/d),a=s-o*d,c=e+w+a*(t-w*2)/d+(a+1)*_,f=x+z+8*o+o*q;T.text(this.#x,n,c,f);}this.#d();}#d(){let e=Math.floor(this.#r/d),x=this.#r-e*d,{left:t,top:i,width:s}=this.#c,n=t+w+x*(s-w*2)/d+x*_,o=i+z+8*e+e*q;for(let a=0;a<_/2;a++)this.#x.fillRect(n+a,o+a,1,8-2*a);}#m=()=>{let e=Math.min(window.innerWidth,window.innerHeight),x=(window.innerWidth-e)*.5,t=(window.innerHeight-e)*.5;this.#t.style.setProperty("width",`${e}px`),this.#t.style.setProperty("height",`${e}px`),this.#t.style.setProperty("left",`${x}px`),this.#t.style.setProperty("top",`${t}px`);};#h(){this.#x.clearRect(0,0,this.#t.width,this.#t.height),this.#x.fillStyle=this.#o;let{left:e,top:x,height:t,width:i}=this.#c;this.#x.fillRect(e-I,x-I,i+I*2,t+I*2),this.#x.fillStyle=this.#a,this.#x.fillRect(e,x,i,t);}#f(e){return typeof e=="string"?e:this.#s[e]??"black"}},_0=r=>new Y(r);var $=class{canvas;#t=24;screenWidth;screenHeight;cellWidth;cellHeight;colors;ctx;background;constructor(e){this.screenWidth=e.screenWidth,this.screenHeight=e.screenHeight,this.cellWidth=e.cellWidth,this.cellHeight=e.cellHeight,this.colors=e.colors,this.background=e.background,this.canvas=document.createElement("canvas"),this.canvas.width=this.cellWidth*e.screenWidth*this.#t,this.canvas.height=this.cellHeight*e.screenHeight*this.#t,this.canvas.style.setProperty("position","absolute"),this.canvas.style.setProperty("image-rendering","pixelated"),this.canvas.classList.add("odyc-renderer-canvas");let x=this.canvas.getContext("2d");if(!x)throw new Error("failled to access context of the canvas");this.ctx=x,this.#x(),document.body.append(this.canvas),window.addEventListener("resize",this.#x);}#x=()=>{let e=this.canvas.width<this.canvas.height?"vertical":"horizontal",x=Math.min(window.innerWidth,window.innerHeight),t=e==="horizontal"?x:x/this.canvas.height*this.canvas.width,i=e==="vertical"?x:x/this.canvas.width*this.canvas.height,s=(window.innerWidth-t)*.5,n=(window.innerHeight-i)*.5;this.canvas.style.setProperty("width",`${t}px`),this.canvas.style.setProperty("height",`${i}px`),this.canvas.style.setProperty("left",`${s}px`),this.canvas.style.setProperty("top",`${n}px`);};render(e,x){this.clear();let[t,i]=x.position;for(let s of e){if(s.sprite===void 0||s.sprite===null||s.visible===!1)continue;let[n,o]=s.position,a=(n-t)*this.cellWidth,c=(o-i)*this.cellHeight;x.isOnScreen(s.position)&&this.drawTile(s.sprite,a,c);}}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.background!==void 0&&(typeof this.background=="number"?this.ctx.fillStyle=this.colors[this.background]??this.colors[0]??"black":this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,this.screenWidth*this.cellWidth*this.#t,this.screenHeight*this.cellHeight*this.#t));}drawTile(e,x,t){if(x+this.cellWidth<0||t+this.cellHeight<0||x>this.screenWidth*this.cellWidth||t>this.screenHeight*this.cellHeight)return;if(typeof e=="number"){let s=this.colors[e];if(!s)return;this.ctx.fillStyle=s,this.ctx.fillRect(Math.floor(x)*this.#t,Math.floor(t)*this.#t,this.cellWidth*this.#t,this.cellHeight*this.#t);return}let i=v(e);for(let s=0;s<this.cellHeight;s++)for(let n=0;n<this.cellWidth;n++){let o=i[s]?.charAt(n);if(!o)continue;let a=+o;if(isNaN(a))continue;let c=this.colors[a];c&&(this.ctx.fillStyle=c,this.ctx.fillRect(Math.floor(x+n)*this.#t,Math.floor(t+s)*this.#t,this.#t,this.#t));}}},I0=r=>new $(r);var M0={waveForm:[{name:"waveForm",defaultValue:0,type:"radio",options:[{value:0,label:"Sine"},{value:1,label:"SawTooth"},{value:2,label:"Square"},{value:3,label:"Triangle"}]}],volume:[{name:"volume",min:0,max:1,step:.01,type:"range",defaultValue:.5}],soundEnveloppe:[{name:"attackTime",min:0,max:2,step:.01,type:"range",defaultValue:0},{name:"sustainTime",min:0,max:2,step:.01,type:"range",defaultValue:.07},{name:"sustainPunch",min:0,max:1,step:.01,type:"range",defaultValue:0},{name:"decayTime",min:0,max:2,step:.01,type:"range",defaultValue:.3}],pitch:[{name:"frequency",min:0,max:4e3,step:1,type:"range",defaultValue:700},{name:"pitchDelta",min:-4e3,max:4e3,step:1,type:"range",defaultValue:0},{name:"pitchDuration",min:0,max:1,step:.01,type:"range",defaultValue:1},{name:"pitchDelay",min:0,max:1,step:.01,type:"range",defaultValue:0}],vibrato:[{name:"vibratoRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"vibratoDepth",min:0,max:100,step:1,type:"range",defaultValue:0}],tremolo:[{name:"tremoloRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"tremoloDepth",min:0,max:1,step:.01,type:"range",defaultValue:0}],filters:[{name:"highPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:0},{name:"highPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0},{name:"lowPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:4e3},{name:"lowPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0}],phaser:[{name:"phaserBaseFrequency",min:0,max:1e3,step:1,type:"range",defaultValue:100},{name:"phaserLfoFrequency",min:0,max:200,step:1,type:"range",defaultValue:50},{name:"phaserDepth",min:0,max:1e3,step:1,type:"range",defaultValue:0}],noise:[{name:"noiseAmount",min:0,max:500,step:1,type:"range",defaultValue:0}]},P=Object.values(M0).flatMap(r=>[...r]),M=P.reduce((r,e)=>({...r,[e.name]:e.defaultValue}),{}),K0=(r,{noiseAmount:e})=>{let x=r.createWaveShaper(),t=44100,i=new Float32Array(t),s=Math.PI/180;for(let n=0;n<t;n++){let o=n*2/t-1;i[n]=(3+Math.random()*e)*o*20*s/(Math.PI+Math.random()*e*Math.abs(o));}return x.curve=i,x.oversample="4x",{input:x,output:x}},Z0=(r,{attackTime:e,sustainTime:x,sustainPunch:t,decayTime:i})=>{let s=r.createGain(),n=r.currentTime;return s.gain.setValueAtTime(0,n),s.gain.linearRampToValueAtTime(1-t,n+e),s.gain.setValueAtTime(1,n+e),s.gain.linearRampToValueAtTime(1-t,n+e+x),s.gain.linearRampToValueAtTime(0,n+e+x+i),{input:s,output:s}},Q0=(r,{highPassCutoff:e,highPassResonance:x})=>{let t=r.createBiquadFilter();return t.type="highpass",t.frequency.value=e,t.Q.value=x,{input:t,output:t}},J0=(r,{lowPassCutoff:e,lowPassResonance:x})=>{let t=r.createBiquadFilter();return t.type="lowpass",t.frequency.value=e,t.Q.value=x,{input:t,output:t}},ee=(r,e,x)=>Math.min(Math.max(r,e),x),te=(r,e)=>Math.round(r*10**e)/10**e,xe=["sine","sawtooth","square","triangle"],re=M0.pitch[0].max,ie=(r,e,{waveForm:x,frequency:t,pitchDelta:i,pitchDuration:s,pitchDelay:n})=>{let o=e*n,a=(e-o)*s,c=r.createOscillator();return c.type=xe[x]??"sine",c.frequency.setValueAtTime(t,r.currentTime),c.frequency.linearRampToValueAtTime(t,r.currentTime+o),c.frequency.linearRampToValueAtTime(ee(0,t+i,re),r.currentTime+o+a),{input:c,output:c,start:()=>c.start(),stop:f=>c.stop(f)}},se=(r,{phaserBaseFrequency:e,phaserLfoFrequency:x,phaserDepth:t})=>{let i=r.createBiquadFilter();i.type="allpass",i.frequency.value=e;let s=r.createOscillator();s.type="sine",s.frequency.value=x;let n=r.createGain();return n.gain.value=t,s.connect(n),n.connect(i.frequency),{input:i,output:i,start:()=>s.start(),stop:o=>s?.stop(o)}},D0=(r,e,x)=>{let t=r.createOscillator(),i=r.createGain();return t.frequency.value=x,i.gain.value=e,t.connect(i),{input:t,output:i,start:()=>t.start(),stop:s=>t.stop(s)}},ne=(r,{tremoloDepth:e,tremoloRate:x})=>D0(r,e,x),oe=(r,{vibratoDepth:e,vibratoRate:x})=>D0(r,e,x),ae=(r,{volume:e})=>{let x=r.createGain();return x.gain.value=e,{input:x,output:x}},L0=(r,e,x)=>{let t=Object.assign({},M,r),i=t.attackTime+t.sustainTime+t.decayTime,s=ie(e,i,t),n=K0(e,t),o=Z0(e,t),a=oe(e,t),c=ne(e,t),f=J0(e,t),S=Q0(e,t),h=se(e,t),l=ae(e,t);a.output.connect(s.input.frequency),c.output.connect(o.input),s.output.connect(n.input),n.output.connect(h.input),h.output.connect(f.input),f.output.connect(S.input),S.output.connect(o.input),o.output.connect(l.input),l.output.connect(x);let u=[a,c,s,h,f,o];return new Promise(m=>{u.forEach(p=>{p.start?.(),p.stop?.(e.currentTime+i);}),s.output.onended=()=>m();})},j=r=>{let e={...M},x=r.searchParams.get("fx");if(!x)return e;let t=decodeURI(x).split(",");for(let i=0;i<P.length;i++){let s=P[i]?.name,n=t[i];s&&n&&!isNaN(Number(n))&&(e[s]=Number(n));}return e};var ce=class{seed;#t;#x;#i;#e;constructor(r){this.seed=r??Date.now(),this.#t=this.seed&4294967295,this.#x=362436069,this.#i=521288629,this.#e=88675123;for(let e=0;e<32;e++)this.#r();}#r(){let r=this.#t^this.#t<<11&4294967295;return this.#t=this.#x,this.#x=this.#i,this.#i=this.#e,this.#e=this.#e^this.#e>>>19^(r^r>>>8),this.#e+2147483648}number(r,e){return r===void 0?(r=0,e=1):e===void 0&&(e=r,r=0),r+(e-r)*this.#r()/4294967295}boolean(r=.5){return this.number(0,1)<r}fromArray(r){return r[Math.floor(this.number(0,r.length))]}},le=r=>(P.forEach(e=>{let x=r[e.name];if(e.type==="range"&&x){let t=e.step.toString().split(".")[1]?.length??0;r[e.name]=te(x,t);}}),Object.assign({},M,r)),K=(r,e)=>le(r(new ce(e))),C={DEFAULT:()=>({}),PICKUP:r=>({...r.boolean()?{pitchDelta:r.number(100,500),pitchDuration:0,pitchDelay:r.number(0,.7)}:{},waveForm:r.fromArray([0,1,2,3]),sustainPunch:r.number(0,.8),sustainTime:r.number(.05,.2),decayTime:r.number(.1,.3),frequency:r.number(900,1700)}),LASER:r=>{let e=r.number(100,1300);return {waveForm:r.fromArray([0,1,2,3]),sustainPunch:r.number(0,.8),sustainTime:r.number(.05,.1),decayTime:r.number(0,.2),frequency:e,pitchDelta:r.number(-e,-100),pitchDuration:1,pitchDelay:r.fromArray([0,r.number(0,.3)])}},JUMP:r=>({waveForm:r.fromArray([1,2]),sustainPunch:r.number(0,.8),sustainTime:r.number(.2,.5),decayTime:r.number(.1,.2),frequency:r.number(100,500),pitchDelta:r.number(200,500),pitchDuration:1,pitchDelay:r.fromArray([0,r.number(0,.3)])}),FALL:r=>{let e=r.number(80,500);return {waveForm:r.fromArray([1,2,3]),sustainPunch:0,sustainTime:r.number(.2,.5),decayTime:r.number(.2,.5),frequency:e,pitchDelta:-e,pitchDuration:1,pitchDelay:r.number(0,.2),vibratoRate:r.number(8,18),vibratoDepth:r.number(10,30),tremoloRate:r.number(5,18),tremoloDepth:r.number(0,1)}},POWERUP:r=>({waveForm:r.fromArray([0,1,2,3]),sustainPunch:r.number(0,1),sustainTime:r.number(.2,.5),decayTime:r.number(.1,.5),frequency:r.number(200,1e3),pitchDelta:r.number(100,300),pitchDuration:1,pitchDelay:r.fromArray([0,r.number(0,.3)]),vibratoRate:r.number(10,18),vibratoDepth:r.number(50,100)}),EXPLOSION:r=>{let e=r.number(200);return {waveForm:r.fromArray([0,1,2,3]),volume:.3,sustainPunch:r.number(0,.3),sustainTime:r.number(.4,1.3),decayTime:r.number(.1,.5),frequency:e,pitchDelta:-e,pitchDuration:1,pitchDelay:r.number(.3),vibratoRate:r.number(0,70),vibratoDepth:r.number(0,100),tremoloRate:r.number(0,70),tremoloDepth:r.number(0,1),phaserDepth:r.number(300,1e3),noiseAmount:r.number(300,500)}},BLIP:r=>({waveForm:r.fromArray([0,1,2,3]),sustainTime:r.number(.02,.1),decayTime:r.number(0,.04),frequency:r.number(600,3e3)}),HIT:r=>{let e=r.number(20,500);return {waveForm:r.fromArray([0,1,2,3]),sustainTime:r.number(.01,.03),sustainPunch:r.number(.5),decayTime:r.number(0,.2),frequency:e,pitchDelta:r.number(-e,-e*.2),noiseAmount:r.number(100)}},FART:r=>{let e=r.number(30,150);return {waveForm:1,volume:.7,sustainPunch:r.number(0,.2),sustainTime:r.number(.1,.5),decayTime:r.number(.3,.5),frequency:e,pitchDelta:-e/2,pitchDuration:1,pitchDelay:.1,vibratoRate:r.number(8,18),vibratoDepth:r.number(10,30),tremoloRate:r.number(35,70),tremoloDepth:r.number(.6,1),lowPassCutoff:e*10,lowPassResonance:10,noiseAmount:r.number(0,30)}},RANDOM:r=>{let e={...M};for(let x=0;x<P.length;x++){let t=P[x];t&&(t.type==="range"?e[t.name]=r.number(t.min,t.max):t.type==="radio"&&(e[t.name]=r.fromArray(t.options.map(i=>i.value))));}return e}};var Z=class{#t;#x;#i=!1;constructor(e){this.#t=new AudioContext,this.#x=this.#t.createGain(),this.#x.gain.value=e.volume,this.#x.connect(this.#t.destination);}async play(...e){if(this.#i)return;this.#i=!0;let x=this.#e(...e);return L0(x,this.#t,this.#x).then(()=>{this.#i=!1;})}#e(...e){let[x,t]=e;return typeof x!="string"?x:L(x)?j(new URL(x)):x in C?K(C[x],t):{}}},F0=r=>new Z(r),he=(...r)=>{let[e,x]=r;return L(e)?j(new URL(e)):e in C?K(C[e],x):{}};var fe=r=>{let e=Object.assign({},J,r),x=w0(e),t=F0(e),i=Q(e),s=I0(e),n=c0(e),o=_0(e),a=A0(e),c=p0(s.canvas,e.filter),f=l0({gameState:x,messageBox:a,camera:i}),S=g0({gameState:x,soundPlayer:t,dialog:n,ender:f});C0(e,l=>{o.isOpen?o.input(l):a.isOpen?l==="ACTION"&&a.next():n.isOpen?l==="ACTION"&&n.next():l!=="ACTION"&&S.update(l);});let h=x0(()=>{c?.setUniforms(x.uniformsStore?.get()),i.update(x.player.playerProxy.position,x.mapStore.getDimensions()),x.actors._store.silentUpdate(l=>l.map(u=>{let m=i.isOnScreen(u.position);if(m!==u.onScreen){let p=x.actors.getCell(...u.position);m?u.onScreenEnter?.(p):u.onScreenLeave?.(p);}return u.onScreen=m,u})),s.render([...x.actors._store.get(),x.player.playerProxy],i),c?.render();},60);return x.actors._store.subscribe(h),x.player.playerStore.subscribe(h),x.uniformsStore.subscribe(h),e.title&&a.open(e.title),d0(x,n,o,t,f,a)};

    exports.createGame = fe;
    exports.createSound = he;

    return exports;

})({});

    const {createGame, createSound} = odyc
//startofthegame
const game = createGame({
  volume: 0.2,
  player: {
    sprite: `
			
			.999999.
			9999999.
			9666666.
			9660606.
			966666..
			996699..
			999966..
			000099..
			`,
    position: [2, 3]
  },
  templates: {
    // robot
    t: {
      sprite: `
			........
			..000005
			.0000555
			.5555550
			.0550550
			.5555500
			.0500055
			.000.000
			`,
      sound: ['FART', 1233476986947410],
      dialog: `Tomer:
Ey Alexius ha-tavi, ma nishma im ha-body?
|

Alex:
Hu oved, adif mimkha.
|
Tomer:
Haha, ani oved bishvilekha! Ata yode’a, ba-layla hayiti be Yavne, ve-acharkach be Holon…
|
|
Alex (quietly):
Chaval she-lo Yavne veholon nifgashu b’to’unah…
|
|
Tomer:
Ma amarta, Alka?
|
Alex:
Amarti she-ata chayim shel telenovela lo nechshevet.
|
|
Tomer:
Ata ohev oti, Aleko. Ata stam met mi-kina.
|
Alex:
Ken, met mamash.`
    },

    // wall
    x: {
      sprite: 0
    }
  },
  map: `
	xxxxxxxx
	x......x
	x......x
	x...t..x
	x......x
	x......x
	x......x
	xxxxxxxx
	`,
  background: 2,
  dialogBackground: 1,
  dialogBorder: 0,
  dialogColor: 0
})
//endofthegame
    
  </script>
</body>
</html>
